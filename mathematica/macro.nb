(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    111521,       2842]
NotebookOptionsPosition[    105801,       2710]
NotebookOutlinePosition[    106137,       2725]
CellTagsIndexPosition[    106094,       2722]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData["Quit"], "Input",
 CellChangeTimes->{{3.761283945021599*^9, 
  3.761283945557975*^9}},ExpressionUUID->"ce7a8f21-2a7b-4df1-9a21-\
5d4ea3d14c5d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OptimizeExpressionToC", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<Tuple\>\"", "\[Rule]", " ", "False"}], ",", 
     RowBox[{"\"\<Pow2\>\"", "\[Rule]", " ", "False"}], ",", " ", 
     RowBox[{"\"\<Sum\>\"", " ", "\[Rule]", " ", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OptimizeExpressionToC", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"options", ":", 
      RowBox[{"OptionsPattern", "[", 
       RowBox[{"{", 
        RowBox[{
        "OptimizeExpressionToC", ",", "Experimental`OptimizeExpression"}], 
        "}"}], "]"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "optimizedExpr", ",", "mainExpr", ",", "n", ",", "m", ",", "defs", ",", 
       "output"}], "}"}], ",", 
     RowBox[{
      RowBox[{"optimizedExpr", "=", 
       RowBox[{"Experimental`OptimizeExpression", "[", 
        RowBox[{"expr", ",", 
         RowBox[{"\"\<OptimizationLevel\>\"", "\[Rule]", "2"}], ",", 
         RowBox[{"\"\<OptimizationSymbol\>\"", "\[Rule]", "copt"}], ",", " ", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"{", "options", "}"}], ",", 
            RowBox[{
            "Options", "[", "Experimental`OptimizeExpression", "]"}]}], "]"}],
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "todo", " ", "check", " ", "if", " ", "any", " ", "expr", " ", "is", 
         " ", "integer", " ", "and", " ", "store", " ", "as", " ", "Int", " ",
          "instead", " ", "of", " ", 
         RowBox[{
          RowBox[{"Real", "?", " ", "e"}], ".", "g", ".", " ", "checking"}], 
         " ", "if", " ", "its", " ", "a", " ", "sum", " ", "or", " ", "prod", 
         " ", "of", " ", "integers"}], ",", " ", 
        RowBox[{
         RowBox[{
         "but", " ", "then", " ", "wouldneed", " ", "to", " ", "know", " ", 
          "about", " ", "intermediate", " ", "stuff", " ", "maybe"}], 
         ".."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "be", " ", "able", " ", "to", " ", "deal", " ", "with", " ", "IF", " ",
         "functions"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"ToString", "@", 
          RowBox[{"optimizedExpr", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "0"}], "]"}], "]"}]}], "\[Equal]", 
         "\"\<Block\>\""}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"n", "=", 
           RowBox[{"Length", "[", 
            RowBox[{"optimizedExpr", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"mainExpr", "=", 
           RowBox[{"optimizedExpr", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2", ",", 
              RowBox[{"n", "+", "1"}]}], "]"}], "]"}]}], ";"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"n", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"mainExpr", "=", 
           RowBox[{"Flatten", "@", 
            RowBox[{"{", 
             RowBox[{"optimizedExpr", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}]}]}], ";"}], "}"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"m", "=", 
       RowBox[{"Length", "[", "mainExpr", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"defs", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"\"\<Real \>\"", "<>", 
          RowBox[{"ToString", "@", 
           RowBox[{"CForm", "@", 
            RowBox[{"optimizedExpr", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2", ",", "i", ",", "1"}], "]"}], "]"}]}]}], 
          "<>", "\"\< = \>\"", "<>", 
          RowBox[{"ToString", "@", 
           RowBox[{"CForm", "@", 
            RowBox[{"optimizedExpr", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2", ",", "i", ",", "2"}], "]"}], "]"}]}]}], 
          "<>", "\"\<;\\n\>\""}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Tuple\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Flatten", "@", 
             RowBox[{"MapIndexed", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"\"\<out\>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<(\>\"", "<>", 
                 RowBox[{"StringJoin", "@", 
                  RowBox[{"Riffle", "[", 
                   RowBox[{
                    RowBox[{"ToString", "/@", 
                    RowBox[{"(", 
                    RowBox[{"#2", "-", "1"}], ")"}]}], ",", "\"\<,\>\""}], 
                   "]"}]}], "<>", "\"\<) = \>\"", "<>", 
                 RowBox[{"ToString", "@", 
                  RowBox[{"CForm", "@", "#1"}]}], "<>", "\"\<;\\n\>\""}], 
                "&"}], ",", 
               RowBox[{"mainExpr", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"ArrayDepth", "[", 
                 RowBox[{"mainExpr", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}], "}"}]}], "]"}]}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", "mainExpr", "]"}]}], "}"}]}], "]"}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Flatten", "@", 
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"\"\<out(\>\"", "<>", 
              RowBox[{"StringJoin", "@", 
               RowBox[{"Riffle", "[", 
                RowBox[{
                 RowBox[{"ToString", "/@", 
                  RowBox[{"(", 
                   RowBox[{"#2", "-", "1"}], ")"}]}], ",", "\"\<,\>\""}], 
                "]"}]}], "<>", "\"\<) = \>\"", "<>", 
              RowBox[{"ToString", "@", 
               RowBox[{"CForm", "@", "#1"}]}], "<>", "\"\<;\\n\>\""}], "&"}], 
            ",", "mainExpr", ",", 
            RowBox[{"{", 
             RowBox[{"ArrayDepth", "[", "mainExpr", "]"}], "}"}]}], "]"}]}]}],
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"defs", ",", "output"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"output", ",", 
         RowBox[{"\"\<Power(E,\>\"", "\[Rule]", "\"\<Exp(\>\""}]}], "]"}]}], 
      ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Rename", " ", "exponent", " ", "function"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"output", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Pow2\>\"", "]"}], ",", 
         RowBox[{"StringReplace", "[", 
          RowBox[{"output", ",", 
           RowBox[{
            RowBox[{
            "RegularExpression", "[", 
             "\"\<Power\\\\(([^\\\\)\\\\(,\\\\s]*),2\\\\)\>\"", "]"}], 
            "\[Rule]", "\"\<($1*$1)\>\""}]}], "]"}], ",", "output"}], "]"}]}],
       ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Replace", " ", "Power", 
        RowBox[{"(", 
         RowBox[{"v", ",", "2"}], ")"}], " ", "with", " ", "multiplication", 
        " ", "v", "*", "v"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Sum\>\"", "]"}], ",", 
         RowBox[{"StringReplace", "[", 
          RowBox[{"output", ",", 
           RowBox[{
            RowBox[{
            "RegularExpression", "[", "\"\<(out\\\\([^\\\\)]*\\\\)) (=)\>\"", 
             "]"}], "\[Rule]", "\"\<$1 +=\>\""}]}], "]"}], ",", "output"}], 
        "]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"out", 
          RowBox[{"(", "..", ")"}]}], " ", "+=", " ", 
         RowBox[{"instead", " ", "of", " ", "out", 
          RowBox[{"(", "..", ")"}]}]}], " ", "=", " ", ".."}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"StringJoin", "[", "output", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SymbolArray", "[", 
    RowBox[{"sname_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "n", "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Symbol", "[", 
          RowBox[{
           RowBox[{"ToString", "[", "sname", "]"}], "<>", 
           RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Symbol", "[", 
          RowBox[{"sname", "<>", 
           RowBox[{"ToString", "[", "i", "]"}], "<>", 
           RowBox[{"ToString", "[", "j", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           RowBox[{
            RowBox[{"n", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "0", ",", 
           RowBox[{
            RowBox[{"n", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}], 
       ",", 
       RowBox[{"Length", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FunctionArray", "[", 
    RowBox[{"sname_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "n", "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Symbol", "[", 
           RowBox[{"ToString", "[", "sname", "]"}], "]"}], "[", "i", "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Symbol", "[", "sname", "]"}], "[", 
          RowBox[{"i", ",", "j"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           RowBox[{
            RowBox[{"n", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "0", ",", 
           RowBox[{
            RowBox[{"n", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}], 
       ",", 
       RowBox[{"Length", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WriteToFile", "[", 
    RowBox[{"path_", ",", "str_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "file", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"file", " ", "=", " ", 
       RowBox[{"OpenWrite", "[", "path", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"file", ",", " ", "str"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "file", "]"}], ";", "\[IndentingNewLine]", 
      "str"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x_", "\[CircleTimes]", "y_"}], ":=", 
   RowBox[{"Outer", "[", 
    RowBox[{"Times", ",", "x", ",", "y"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.753975422835587*^9, 3.753975423293962*^9}, {
   3.7540239966734324`*^9, 3.7540239970573263`*^9}, {3.754027054440576*^9, 
   3.754027057576805*^9}, {3.7540327970988503`*^9, 3.754032835057887*^9}, {
   3.754032879897766*^9, 3.754032882096696*^9}, {3.754040031316481*^9, 
   3.7540400345624104`*^9}, {3.754040206280881*^9, 3.754040473357143*^9}, {
   3.7540405498125467`*^9, 3.7540405534453278`*^9}, {3.7540407321297626`*^9, 
   3.754040776585314*^9}, {3.754041299732593*^9, 3.7540413957709846`*^9}, {
   3.7540541075229607`*^9, 3.754054114561799*^9}, 3.754054211519972*^9, 
   3.7540544095763397`*^9, {3.754110218058097*^9, 3.7541102371630697`*^9}, {
   3.754110761699958*^9, 3.754110787710558*^9}, {3.754111043701708*^9, 
   3.754111076692844*^9}, {3.754111138689981*^9, 3.7541111403926353`*^9}, 
   3.754116221144569*^9, {3.75585915227102*^9, 3.7558592296487713`*^9}, {
   3.755859267090712*^9, 3.755859267720997*^9}, {3.755859327392712*^9, 
   3.755859401526217*^9}, {3.755859476640418*^9, 3.755859587892376*^9}, {
   3.761285641490581*^9, 3.761285645820663*^9}, {3.761287074563222*^9, 
   3.761287075410365*^9}, {3.761287135034172*^9, 3.76128713552135*^9}, {
   3.764044232594451*^9, 3.7640442707305737`*^9}, {3.764044403857478*^9, 
   3.764044407975996*^9}, {3.7640445663659554`*^9, 3.76404457569142*^9}, {
   3.764044612184819*^9, 3.764044641693288*^9}, {3.764044682748267*^9, 
   3.7640447703796463`*^9}, {3.764044803035391*^9, 3.7640449025140953`*^9}, {
   3.764045320085903*^9, 3.764045330892694*^9}, {3.764045773240902*^9, 
   3.764045789478722*^9}, {3.764045924709599*^9, 3.7640459439889383`*^9}, {
   3.764058971464018*^9, 
   3.7640589777354097`*^9}},ExpressionUUID->"3612ea70-5f38-4e37-bd1b-\
6c0b5a9bdcae"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.764044913541362*^9, 3.764044988884789*^9}, {
   3.764045021525083*^9, 3.7640450391181993`*^9}, {3.7640451062850122`*^9, 
   3.7640451834112663`*^9}, {3.76404522094039*^9, 3.764045260282496*^9}, {
   3.764045337890036*^9, 3.764045402400825*^9}, 
   3.764056468329515*^9},ExpressionUUID->"0fb39144-7c88-4dd5-b471-\
a89bfeaad29d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"define", " ", "vertex", " ", "inputs"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"xlocal", " ", "=", " ", 
     RowBox[{"FunctionArray", "[", 
      RowBox[{"\"\<xloc\>\"", ",", "18"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"x0", " ", "=", " ", 
     RowBox[{"xlocal", "[", 
      RowBox[{"[", 
       RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"x1", " ", "=", " ", 
     RowBox[{"xlocal", "[", 
      RowBox[{"[", 
       RowBox[{"4", ";;", "6"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"x2", " ", "=", " ", 
     RowBox[{"xlocal", "[", 
      RowBox[{"[", 
       RowBox[{"7", ";;", "9"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xn0", " ", "=", " ", 
     RowBox[{"xlocal", "[", 
      RowBox[{"[", 
       RowBox[{"10", ";;", "12"}], "]"}], "]"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "neighbor", " ", "vertex", " ", "of", " ", "face", " ", "sharing", " ", 
      "e0"}], " ", "=", " ", 
     RowBox[{"x1", "-", "x0"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xn1", "=", " ", 
     RowBox[{"xlocal", "[", 
      RowBox[{"[", 
       RowBox[{"13", ";;", "15"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xn2", " ", "=", " ", 
     RowBox[{"xlocal", "[", 
      RowBox[{"[", 
       RowBox[{"16", ";;", "18"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"other", " ", "assumed", " ", "inputs"}], ",", " ", 
     RowBox[{"constant", " ", "per", " ", 
      RowBox[{"remeshing", ":", " ", "invDm"}]}], ",", " ", "A", ",", " ", 
     "l_i", ",", " ", "t_i"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"stretching", " ", 
     RowBox[{"tensor", " ", "/", " ", "first"}], " ", "fundamental", " ", 
     "form"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"F", " ", "=", " ", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"x1", " ", "-", "x0"}], ",", " ", 
         RowBox[{"x2", "-", " ", "x0"}]}], "}"}], "]"}], ".", 
      RowBox[{"FunctionArray", "[", 
       RowBox[{"\"\<invDm\>\"", ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "]"}]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"deformation", " ", "gradient", " ", "F"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"x1", "-", 
        RowBox[{"x0", " ", "x2"}], "-", "x0"}], ")"}], " ", "invDm"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]", " ", "=", " ", 
     RowBox[{
      RowBox[{"Transpose", "[", "F", "]"}], ".", " ", "F"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"curvature", " ", 
      RowBox[{"tensor", " ", "/", " ", "shape"}], " ", 
      RowBox[{"operator", " ", "/", " ", "second"}], " ", "fundamental", " ", 
      "form", " ", "\[Kappa]"}], " ", "="}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n", " ", "=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{"Cross", "[", 
       RowBox[{
        RowBox[{"x1", " ", "-", "x0"}], ",", " ", 
        RowBox[{"x2", "-", " ", "x0"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n0", " ", "=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{"Cross", "[", 
       RowBox[{
        RowBox[{"xn0", " ", "-", "x0"}], ",", " ", 
        RowBox[{"x1", "-", " ", "x0"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n1", " ", "=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{"Cross", "[", 
       RowBox[{
        RowBox[{"xn1", " ", "-", "x1"}], ",", " ", 
        RowBox[{"x2", "-", " ", "x1"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n2", " ", "=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{"Cross", "[", 
       RowBox[{
        RowBox[{"xn2", " ", "-", "x2"}], ",", " ", 
        RowBox[{"x0", "-", " ", "x2"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"https", ":"}], "//", 
      RowBox[{
       RowBox[{
        RowBox[{"stackoverflow", ".", "com"}], "/", "a"}], "/", 
       "33920320"}]}], ",", " ", 
     RowBox[{
     "note", " ", "it", " ", "seems", " ", "that", " ", "cannot", " ", 
      "construct", " ", "plane", " ", "normal", " ", "from", " ", "uv", " ", 
      "bc", " ", "rotates", " ", "with", " ", "order"}], ",", " ", 
     RowBox[{
     "instead", " ", "we", " ", "have", " ", "to", " ", "take", " ", "the", 
      " ", "edge", " ", "vertices", " ", "to", " ", "get", " ", "the", " ", 
      "plane", " ", "normal"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Angle", "[", 
      RowBox[{"u_", ",", "v_", ",", " ", "n_"}], "]"}], ":=", " ", 
     RowBox[{"ArcTan", "[", 
      RowBox[{
       RowBox[{"u", ".", "v"}], ",", 
       RowBox[{"n", ".", " ", 
        RowBox[{"Cross", "[", 
         RowBox[{"u", ",", "v"}], "]"}]}]}], "]"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"note", " ", "that", " ", "mathematica", " ", "arctan", 
      RowBox[{"(", 
       RowBox[{"x", ",", "y"}], ")"}], " ", "vs", " ", "cpp", " ", "atan2", 
      RowBox[{"(", 
       RowBox[{"y", ",", "x"}], ")"}]}], ",", " ", 
     RowBox[{"assume", " ", "normalized", " ", "u", " ", "v", " ", "n"}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Theta]0", " ", "=", 
     RowBox[{"Angle", "[", 
      RowBox[{"n", ",", "n0", ",", " ", 
       RowBox[{"Normalize", "[", 
        RowBox[{"x1", "-", " ", "x0"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Theta]1", " ", "=", 
     RowBox[{"Angle", "[", 
      RowBox[{"n", ",", "n1", ",", " ", 
       RowBox[{"Normalize", "[", 
        RowBox[{"x2", "-", " ", "x1"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Theta]2", " ", "=", 
     RowBox[{"Angle", "[", 
      RowBox[{"n", ",", "n2", ",", " ", 
       RowBox[{"Normalize", "[", 
        RowBox[{"x0", "-", " ", "x2"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"phi", "[", "theta_", "]"}], " ", ":=", " ", "theta"}], ";", 
     " ", 
     RowBox[{"2", "*", "tan", 
      RowBox[{"(", 
       RowBox[{"theta", "/", "2"}], ")"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"phi", "[", "theta_", "]"}], " ", ":=", " ", "theta"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tot", "[", "name_", "]"}], " ", ":=", 
     RowBox[{
      RowBox[{"FunctionArray", "[", 
       RowBox[{"name", ",", "2"}], "]"}], "\[CircleTimes]", 
      RowBox[{"FunctionArray", "[", 
       RowBox[{"name", ",", "2"}], "]"}]}]}], " ", ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
     "vec2", " ", "because", " ", "2", "d", " ", "material", " ", "config"}], 
     " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"\[Kappa]", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"phi", "[", "\[Theta]0", "]"}], "-", 
          RowBox[{"phi", "[", "thetarest0", "]"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"2", " ", "A", " ", "l0"}], ")"}]}], 
       RowBox[{"tot", "[", "\"\<t0\>\"", "]"}]}], " ", "+", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"phi", "[", "\[Theta]1", "]"}], "-", 
          RowBox[{"phi", "[", "thetarest1", "]"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"2", " ", "A", " ", "l1"}], ")"}]}], " ", 
       RowBox[{"tot", "[", "\"\<t1\>\"", "]"}]}], " ", "+", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"phi", "[", "\[Theta]2", "]"}], "-", 
          RowBox[{"phi", "[", "thetarest2", "]"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"2", " ", "A", " ", "l2"}], ")"}]}], " ", 
       RowBox[{"tot", "[", "\"\<t2\>\"", "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "combined", " ", "parts", " ", "without", " ", "symmetric", " ", 
     "redundancy", " ", "for", " ", "chain", " ", "ruling"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]\[Kappa]", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\[Epsilon]", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
       RowBox[{"\[Epsilon]", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
       RowBox[{"\[Epsilon]", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
       RowBox[{"\[Kappa]", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
       RowBox[{"\[Kappa]", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
       RowBox[{"\[Kappa]", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7540232899336643`*^9, 3.754023308473406*^9}, {
   3.7540233663375263`*^9, 3.7540234438714533`*^9}, {3.7540234759831657`*^9, 
   3.754023617436458*^9}, {3.75402368429877*^9, 3.754023760119609*^9}, {
   3.754023808826668*^9, 3.754023869545535*^9}, {3.754023911290193*^9, 
   3.754023978879448*^9}, {3.754024282052266*^9, 3.754024313580803*^9}, {
   3.754024547049345*^9, 3.7540245994799223`*^9}, {3.754025460239439*^9, 
   3.7540255983227377`*^9}, {3.7540258137850018`*^9, 3.754025978711053*^9}, {
   3.754026038895108*^9, 3.754026081342535*^9}, {3.754026129685459*^9, 
   3.75402615849335*^9}, {3.7540262434835052`*^9, 3.754026287097475*^9}, {
   3.754026322980064*^9, 3.754026368626458*^9}, {3.75402640305891*^9, 
   3.754026487825637*^9}, {3.754026669101832*^9, 3.7540267121343517`*^9}, 
   3.7540400434692297`*^9, 3.754040480622787*^9, {3.75404054710104*^9, 
   3.75404054777276*^9}, {3.754040779169834*^9, 3.7540408894011106`*^9}, {
   3.7540516192312183`*^9, 3.754051646630447*^9}, {3.754114193013981*^9, 
   3.75411420576961*^9}, {3.7541155028678617`*^9, 3.754115517689828*^9}, {
   3.754116116322241*^9, 3.754116117185795*^9}, {3.754117779766054*^9, 
   3.75411778870254*^9}, {3.754117819301795*^9, 3.754117887518787*^9}, {
   3.7542831537385483`*^9, 3.7542831953926773`*^9}, {3.7558451061297607`*^9, 
   3.755845132041484*^9}, {3.7558596007652903`*^9, 3.7558596124847813`*^9}, {
   3.761284047822206*^9, 3.7612840481560087`*^9}, {3.761285081877398*^9, 
   3.7612851055151243`*^9}, {3.761285948779154*^9, 3.761285957698354*^9}, {
   3.7649237958301973`*^9, 3.7649238006264343`*^9}, {3.764924342021134*^9, 
   3.764924376748556*^9}, {3.764926705799632*^9, 3.7649267509395638`*^9}, {
   3.764926860502172*^9, 3.764926868429837*^9}, {3.764927978489457*^9, 
   3.764928026017295*^9}, {3.764928364181189*^9, 3.764928401385648*^9}, {
   3.7649299776142817`*^9, 3.764930022149885*^9}, {3.764930064397726*^9, 
   3.76493015861243*^9}},ExpressionUUID->"4776e7ad-a76c-49e4-b3e9-\
6cbde6d13ec3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Output", " ", "strains"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"simplifyTimes", "=", 
     RowBox[{"{", 
      RowBox[{"1", ",", "60"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"assumptions", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Variables", "[", 
        RowBox[{"Level", "[", 
         RowBox[{"\[Epsilon]\[Kappa]", ",", 
          RowBox[{"{", 
           RowBox[{"-", "2"}], "}"}]}], "]"}], "]"}], " ", "\[Element]", " ", 
       "Reals"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetDirectory", " ", "@", " ", 
     RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt1", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{"\[Epsilon]\[Kappa]", ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"opt1", " ", "//", " ", "Dimensions"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<ek_val.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", "opt1", "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt2", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"Grad", "[", 
         RowBox[{"opt1", ",", "xlocal"}], "]"}], ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"opt2", " ", "//", " ", "Dimensions"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<ek_valgrad.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"opt1", ",", "opt2"}], "}"}], ",", " ", 
        RowBox[{"\"\<Tuple\>\"", "\[Rule]", " ", "True"}]}], "]"}]}], "]"}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt3", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"Grad", "[", 
         RowBox[{"opt2", ",", "xlocal"}], "]"}], ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}]}], "]"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"opt3", " ", "//", " ", "Dimensions"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<ek_valgradhess.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"opt1", ",", "opt2", ",", " ", "opt3"}], "}"}], ",", " ", 
        RowBox[{"\"\<Tuple\>\"", "\[Rule]", " ", "True"}]}], "]"}]}], "]"}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"Beep", "[", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.754032175212368*^9, 3.754032198551841*^9}, {
   3.754033064957539*^9, 3.754033067277697*^9}, {3.754033224746778*^9, 
   3.754033345432867*^9}, {3.754033383569584*^9, 3.754033434288007*^9}, {
   3.7540336403658943`*^9, 3.754033640742869*^9}, {3.754037019002068*^9, 
   3.7540370292736397`*^9}, {3.7540373001657877`*^9, 3.754037312652113*^9}, 
   3.7540373989501762`*^9, {3.754037599233857*^9, 3.754037626481627*^9}, {
   3.754037704360797*^9, 3.754037894670238*^9}, {3.754038001079235*^9, 
   3.754038001588687*^9}, {3.7540381456990137`*^9, 3.754038224514159*^9}, {
   3.754038257410974*^9, 3.754038257848946*^9}, {3.754040025674768*^9, 
   3.75404002796369*^9}, {3.754040894895322*^9, 3.7540409311501827`*^9}, {
   3.75404118086233*^9, 3.7540411911237307`*^9}, 3.7540416773419037`*^9, {
   3.754042049651032*^9, 3.754042049794258*^9}, {3.754056098934525*^9, 
   3.754056104107953*^9}, {3.7541112994236526`*^9, 3.7541113330742407`*^9}, {
   3.7541115167581263`*^9, 3.754111516796309*^9}, {3.754111910274416*^9, 
   3.754111918824725*^9}, {3.754313825499147*^9, 3.75431384945665*^9}, {
   3.76128408226604*^9, 3.7612841539609632`*^9}, 3.761284371118311*^9, {
   3.761284495235053*^9, 3.7612845462025633`*^9}, 3.761284599362053*^9, 
   3.7649244087787647`*^9, 3.764931181935761*^9, {3.764931274580656*^9, 
   3.764931275812076*^9}, {3.764931986254306*^9, 
   3.7649319879077387`*^9}},ExpressionUUID->"db2d1574-3286-468b-8744-\
a23c0c930e49"],

Cell[BoxData[
 RowBox[{"{", "6", "}"}]], "Output",
 CellChangeTimes->{3.75404167919634*^9, 3.75404210721097*^9, 
  3.754054415521418*^9, 3.754111329836998*^9, 3.754111531922576*^9, 
  3.754117933522828*^9, 3.754313859378401*^9, 3.755845161474073*^9, 
  3.761284179208387*^9, 3.761284637623682*^9, 3.7612851540901203`*^9, 
  3.761285238211226*^9, 3.761285281992118*^9, 3.761285978480341*^9, 
  3.764924590931594*^9, 3.764930423768496*^9, 
  3.76493147108349*^9},ExpressionUUID->"4b556933-a119-491d-9869-f5c66a605fbc"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"6", ",", "18"}], "}"}]], "Output",
 CellChangeTimes->{3.75404167919634*^9, 3.75404210721097*^9, 
  3.754054415521418*^9, 3.754111329836998*^9, 3.754111531922576*^9, 
  3.754117933522828*^9, 3.754313859378401*^9, 3.755845161474073*^9, 
  3.761284179208387*^9, 3.761284637623682*^9, 3.7612851540901203`*^9, 
  3.761285238211226*^9, 3.761285281992118*^9, 3.761285978480341*^9, 
  3.764924590931594*^9, 3.764930423768496*^9, 
  3.764931531500183*^9},ExpressionUUID->"d4537437-a6d6-4a7f-81fe-\
225b8dec9e9d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"6", ",", "18", ",", "18"}], "}"}]], "Output",
 CellChangeTimes->{3.75404167919634*^9, 3.75404210721097*^9, 
  3.754054415521418*^9, 3.754111329836998*^9, 3.754111531922576*^9, 
  3.754117933522828*^9, 3.754313859378401*^9, 3.755845161474073*^9, 
  3.761284179208387*^9, 3.761284637623682*^9, 3.7612851540901203`*^9, 
  3.761285238211226*^9, 3.761285281992118*^9, 3.761285978480341*^9, 
  3.764924590931594*^9, 3.764930423768496*^9, 
  3.764931618050846*^9},ExpressionUUID->"4aa095ed-aab4-46c6-97b2-\
abfbe5abe313"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7541117150554028`*^9, 3.754111717162174*^9}, 
   3.754111909208987*^9},ExpressionUUID->"83828bfb-ee37-4639-8b6c-\
321bc715f6f6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "MAKE", " ", "SOME", " ", "TEST", " ", "ENERGY", " ", "AND", " ", "OUTPUT",
     " ", "ALSO", " ", "PSI", 
    RowBox[{"(", "ek", ")"}], " ", "AND", " ", "DERIVATIVES"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"tr", "^", "2"}], " ", 
     RowBox[{"(", 
      RowBox[{"eps", "-", "I"}], ")"}]}], " ", "+", " ", 
    RowBox[{"tr", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"eps", "-", "I"}], ")"}], "^", "2"}], ")"}]}], " ", "+", " ", 
    RowBox[{
     RowBox[{"tr", "^", "2"}], 
     RowBox[{"(", "kappa", ")"}]}], " ", "+", " ", 
    RowBox[{
     RowBox[{"det", "^", "2"}], 
     RowBox[{"(", "kappa", ")"}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ek", " ", "=", " ", 
     RowBox[{"FunctionArray", "[", 
      RowBox[{"\"\<ekdof\>\"", ",", "6"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"EE", " ", "=", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ek", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"ek", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ek", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"ek", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "}"}], " ", "-", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"KK", " ", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ek", "[", 
          RowBox[{"[", "4", "]"}], "]"}], ",", 
         RowBox[{"ek", "[", 
          RowBox[{"[", "5", "]"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ek", "[", 
          RowBox[{"[", "5", "]"}], "]"}], ",", 
         RowBox[{"ek", "[", 
          RowBox[{"[", "6", "]"}], "]"}]}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Psi]", " ", "=", " ", 
     RowBox[{
      RowBox[{"a0", " ", 
       RowBox[{
        RowBox[{"Tr", "[", "EE", "]"}], "^", "2"}]}], "+", 
      RowBox[{"a1", " ", 
       RowBox[{"Tr", "[", 
        RowBox[{"EE", ".", "EE"}], "]"}]}], " ", "+", " ", 
      RowBox[{"b0", " ", 
       RowBox[{
        RowBox[{"Tr", "[", "KK", "]"}], "^", "2"}]}], " ", "+", " ", 
      RowBox[{"b1", " ", 
       RowBox[{
        RowBox[{"Det", "[", "KK", "]"}], "^", "2"}]}]}]}], " ", 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.75403383236524*^9, 3.754033850753985*^9}, {
   3.75403827019179*^9, 3.7540382835192347`*^9}, {3.754038430374539*^9, 
   3.754038511116502*^9}, {3.754038735075407*^9, 3.754038909215828*^9}, {
   3.754039108246768*^9, 3.754039177548894*^9}, 3.754039241125738*^9, {
   3.754040587083583*^9, 3.7540405998519077`*^9}, {3.754040687579975*^9, 
   3.754040719234311*^9}, 3.754041211196226*^9, {3.754042060049485*^9, 
   3.7540420653762827`*^9}, {3.754125825788766*^9, 3.754125828547031*^9}, {
   3.754131899686879*^9, 3.7541319003028097`*^9}, {3.761286983033908*^9, 
   3.761287023952009*^9}},ExpressionUUID->"34057c6a-bdd5-48dc-bdfb-\
ca87f3c47be6"],

Cell[BoxData[{
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Psi]", " ", "/.", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a0", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"a1", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"b0", "\[Rule]", "1"}], ",", " ", 
      RowBox[{"b1", "\[Rule]", 
       RowBox[{"1", "/", "100"}]}], ",", " ", 
      RowBox[{"ek0", "\[Rule]", "i"}], ",", 
      RowBox[{"ek1", "\[Rule]", "0"}], ",", 
      RowBox[{"ek2", "\[Rule]", "1"}], ",", 
      RowBox[{"ek3", "\[Rule]", "0"}], ",", 
      RowBox[{"ek4", "\[Rule]", "0"}], ",", 
      RowBox[{"ek5", "\[Rule]", "0"}]}], "}"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", "0.5", ",", "1.5"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Psi]", " ", "/.", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a0", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"a1", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"b0", "\[Rule]", "1"}], ",", " ", 
      RowBox[{"b1", "\[Rule]", 
       RowBox[{"1", "/", "100"}]}], ",", " ", 
      RowBox[{"ek0", "\[Rule]", "1"}], ",", 
      RowBox[{"ek1", "\[Rule]", "i"}], ",", 
      RowBox[{"ek2", "\[Rule]", "1"}], ",", 
      RowBox[{"ek3", "\[Rule]", "0"}], ",", 
      RowBox[{"ek4", "\[Rule]", "0"}], ",", 
      RowBox[{"ek5", "\[Rule]", "0"}]}], "}"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", 
     RowBox[{"-", "1.0"}], ",", "1.0"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Psi]", " ", "/.", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a0", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"a1", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"b0", "\[Rule]", "1"}], ",", " ", 
      RowBox[{"b1", "\[Rule]", 
       RowBox[{"1", "/", "100"}]}], ",", " ", 
      RowBox[{"ek0", "\[Rule]", "1"}], ",", 
      RowBox[{"ek1", "\[Rule]", "0"}], ",", 
      RowBox[{"ek2", "\[Rule]", "1"}], ",", 
      RowBox[{"ek3", "\[Rule]", "i"}], ",", 
      RowBox[{"ek4", "\[Rule]", "0"}], ",", 
      RowBox[{"ek5", "\[Rule]", "0"}]}], "}"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", 
     RowBox[{"-", "30"}], ",", "30"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Psi]", " ", "/.", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a0", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"a1", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"b0", "\[Rule]", "1"}], ",", " ", 
      RowBox[{"b1", "\[Rule]", 
       RowBox[{"1", "/", "100"}]}], ",", " ", 
      RowBox[{"ek0", "\[Rule]", "1"}], ",", 
      RowBox[{"ek1", "\[Rule]", "0"}], ",", 
      RowBox[{"ek2", "\[Rule]", "1"}], ",", 
      RowBox[{"ek3", "\[Rule]", "0"}], ",", 
      RowBox[{"ek4", "\[Rule]", "i"}], ",", 
      RowBox[{"ek5", "\[Rule]", "0"}]}], "}"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", 
     RowBox[{"-", 
      RowBox[{"Sqrt", "[", "30", "]"}]}], ",", 
     RowBox[{"Sqrt", "[", "30", "]"}]}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Psi]", " ", "/.", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"a0", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"a1", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"b0", "\[Rule]", "1"}], ",", " ", 
      RowBox[{"b1", "\[Rule]", 
       RowBox[{"1", "/", "100"}]}], ",", " ", 
      RowBox[{"ek0", "\[Rule]", "1"}], ",", 
      RowBox[{"ek1", "\[Rule]", "0"}], ",", 
      RowBox[{"ek2", "\[Rule]", "1"}], ",", 
      RowBox[{"ek3", "\[Rule]", "0"}], ",", 
      RowBox[{"ek4", "\[Rule]", "i"}], ",", 
      RowBox[{"ek5", "\[Rule]", "i"}]}], "}"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", 
     RowBox[{"-", "30"}], ",", "30"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.755941813949402*^9, 3.755942105002055*^9}, {
  3.7559421531453876`*^9, 
  3.755942203655497*^9}},ExpressionUUID->"eb0f7c7c-29e0-4630-8951-\
518f9428c379"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"simplifyTimes", "=", 
   RowBox[{"{", 
    RowBox[{"1", ",", "180"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"assumptions", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Variables", "[", 
      RowBox[{"Level", "[", 
       RowBox[{"\[Psi]", " ", ",", 
        RowBox[{"{", 
         RowBox[{"-", "2"}], "}"}]}], "]"}], "]"}], " ", "\[Element]", " ", 
     "Reals"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", " ", "@", " ", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"opt1", " ", "=", " ", 
   RowBox[{"Quiet", "[", 
    RowBox[{"Simplify", "[", 
     RowBox[{
      RowBox[{"{", "\[Psi]", "}"}], " ", ",", 
      RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
      RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WriteToFile", "[", 
   RowBox[{"\"\<psi_val.txt\>\"", ",", " ", 
    RowBox[{"OptimizeExpressionToC", "[", "opt1", "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"opt2", " ", "=", " ", 
   RowBox[{"Quiet", "[", 
    RowBox[{"Simplify", "[", 
     RowBox[{
      RowBox[{"Grad", "[", 
       RowBox[{"\[Psi]", ",", "ek"}], "]"}], ",", 
      RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
      RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WriteToFile", "[", 
   RowBox[{"\"\<psi_grad.txt\>\"", ",", " ", 
    RowBox[{"OptimizeExpressionToC", "[", "opt2", "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"opt3", " ", "=", " ", 
   RowBox[{"Quiet", "[", 
    RowBox[{"Simplify", "[", 
     RowBox[{
      RowBox[{"Grad", "[", 
       RowBox[{"opt2", ",", "ek"}], "]"}], ",", 
      RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
      RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WriteToFile", "[", 
   RowBox[{"\"\<psi_gradhess.txt\>\"", ",", " ", 
    RowBox[{"OptimizeExpressionToC", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"opt2", ",", "opt3"}], "}"}], ",", "True"}], "]"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.754038922850649*^9, 3.754038996535083*^9}, {
   3.754039043295809*^9, 3.7540390453819723`*^9}, {3.754039076574335*^9, 
   3.754039098261621*^9}, {3.754039188030126*^9, 3.754039206379929*^9}, {
   3.7540392609374723`*^9, 3.754039289859956*^9}, {3.754039395692704*^9, 
   3.7540394006826563`*^9}, 3.754039450610968*^9, 3.75404061545963*^9, 
   3.754040645580265*^9, {3.7540411573425083`*^9, 3.754041167370934*^9}, {
   3.754041221987308*^9, 3.7540412342043047`*^9}, {3.754042093303154*^9, 
   3.7540420996119623`*^9}, {3.754053868043047*^9, 3.754053961720331*^9}, {
   3.754054124503242*^9, 3.754054132021907*^9}, {3.754054268116549*^9, 
   3.75405426948269*^9}, 3.754054439148459*^9, {3.754056114580714*^9, 
   3.754056114893602*^9}, {3.7541094834748783`*^9, 3.754109563441243*^9}, {
   3.7541108269628077`*^9, 3.754110830921287*^9}, {3.761284617888323*^9, 
   3.7612846807361*^9}},ExpressionUUID->"ad57a804-d84a-4d8b-b266-\
2a66855df4a3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"tests", " ", "collecting", " ", "powers"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
      "might", " ", "be", " ", "required", " ", "for", " ", "speed", " ", 
       "up"}], ".."}], "  ", "bc", " ", "optimizeexpressiontoc", " ", "fails",
      " ", "for", " ", 
     RowBox[{"e", ".", "g", ".", " ", 
      RowBox[{
       RowBox[{"(", "ab", ")"}], "^", "2"}]}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"combinePowers", "[", "expr_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Inactivate", "[", 
      RowBox[{"expr", ",", "Power"}], "]"}], "//.", 
     RowBox[{
      RowBox[{
       RowBox[{"HoldPattern", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Inactive", "[", "Power", "]"}], "[", 
          RowBox[{"z1_", ",", "n_"}], "]"}], " ", 
         RowBox[{
          RowBox[{"Inactive", "[", "Power", "]"}], "[", 
          RowBox[{"z2_", ",", "m_"}], "]"}]}], "]"}], "/;", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Abs", "[", "m", "]"}], "\[Equal]", "n"}], ")"}]}], 
      "\[RuleDelayed]", 
      RowBox[{
       RowBox[{"Inactive", "[", "Power", "]"}], "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"z1", " ", 
          RowBox[{"Power", "[", 
           RowBox[{"z2", ",", 
            RowBox[{"Sign", "[", "m", "]"}]}], "]"}]}], ")"}], ",", "n"}], 
       "]"}]}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"OptimizeExpressionToC", "[", "  ", 
     RowBox[{"{", 
      RowBox[{"Inactivate", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"x", "/", "y"}], ")"}], "^", "2"}], ",", " ", "Power"}], 
       "]"}], "}"}], " ", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"combinePowers", "[", "opt1", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"combinePowers", "[", 
     RowBox[{"Grad", "[", 
      RowBox[{"opt1", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ek", "[", "0", "]"}], ",", 
         RowBox[{"ek", "[", "1", "]"}]}], "}"}]}], "]"}], " ", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"OptimizeExpressionToC", "[", "  ", 
     RowBox[{"{", 
      RowBox[{"Simplify", " ", "@", " ", 
       RowBox[{"combinePowers", "[", "opt1", "]"}]}], "}"}], " ", "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.75586161660637*^9, 3.755861617318481*^9}, {
  3.755861649458168*^9, 3.755861656959593*^9}, {3.755861689448842*^9, 
  3.755861760295471*^9}, {3.755861839513178*^9, 3.755862008827553*^9}, {
  3.755862168771591*^9, 
  3.7558622128175373`*^9}},ExpressionUUID->"409b12fd-5167-44d1-93b6-\
286f6585bbfd"],

Cell[BoxData[""], "Input",ExpressionUUID->"fdbf14dc-4ba9-49ca-a342-eac3359c8982"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{
  3.763356219028224*^9},ExpressionUUID->"9cc917c8-d170-4c20-ad91-\
c63508415c47"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"data", "-", 
    RowBox[{"driven", " ", "energy", "  ", "NEW"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"eta1D", "[", 
      RowBox[{"x_", ",", "i_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Total", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Symbol", "[", 
          RowBox[{
           RowBox[{"ToString", "[", "C", "]"}], "<>", 
           RowBox[{"ToString", "[", "i", "]"}], "<>", 
           RowBox[{"ToString", "[", "#", "]"}]}], "]"}], " ", 
         SuperscriptBox[
          RowBox[{"x", "[", 
           RowBox[{"[", 
            RowBox[{"i", "+", "1"}], "]"}], "]"}], "#"]}], "&"}], " ", "/@", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}]}], " ", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"eta2D", "[", 
      RowBox[{"x_", ",", "i_", ",", "j_"}], "]"}], " ", ":=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Symbol", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "C", "]"}], "<>", 
          RowBox[{"ToString", "[", "i", "]"}], "<>", 
          RowBox[{"ToString", "[", "j", "]"}], "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], " ", 
        SuperscriptBox[
         RowBox[{"x", "[", 
          RowBox[{"[", 
           RowBox[{"i", "+", "1"}], "]"}], "]"}], 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]], 
        SuperscriptBox[
         RowBox[{"x", "[", 
          RowBox[{"[", 
           RowBox[{"j", "+", "1"}], "]"}], "]"}], 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}]]}], "&"}], " ", "/@", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}]}], "}"}]}]}], " ", ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"eta1D", "[", 
       RowBox[{"x_", ",", "i_"}], "]"}], " ", ":=", " ", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"C1D", "[", 
           RowBox[{"i", ",", "#"}], "]"}], " ", 
          SuperscriptBox[
           RowBox[{"x", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}], "#"]}], "&"}], " ", "/@", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}]}], " ", "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"eta2D", "[", 
       RowBox[{"x_", ",", "i_", ",", "j_"}], "]"}], " ", ":=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"C2D", "[", 
          RowBox[{"i", ",", "j", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", 
         SuperscriptBox[
          RowBox[{"x", "[", 
           RowBox[{"[", 
            RowBox[{"i", "+", "1"}], "]"}], "]"}], 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}]], 
         SuperscriptBox[
          RowBox[{"x", "[", 
           RowBox[{"[", 
            RowBox[{"j", "+", "1"}], "]"}], "]"}], 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]]}], "&"}], " ", "/@", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}]}], "}"}]}]}], " ", ";"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"coords2D", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "5"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "5"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "5"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"coords2D", " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", "<", " ", "j"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}], ",", "Nothing"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "0", ",", "5"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "0", ",", "5"}], "}"}]}], "]"}], ",", "1"}], 
     "]"}]}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"ALL", " ", "coords"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"psi", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"C0", " ", "+", " ", 
     RowBox[{"Total", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"eta1D", "[", 
         RowBox[{"x", ",", "i"}], "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"i", ",", "0", ",", "5"}], "}"}]}], "]"}], "]"}], " ", "+", 
     " ", 
     RowBox[{"Total", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"eta2D", "[", 
          RowBox[{"x", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "&"}], "/@", " ", 
        "coords2D"}], ",", " ", "2"}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]\[Kappa]", " ", "=", " ", 
     RowBox[{"FunctionArray", "[", 
      RowBox[{"\"\<ek\>\"", ",", "6"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]\[Kappa]shift", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "1", ",", "0", ",", "0", ",", "0"}], 
      "}"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"same", " ", "shift", " ", "as", " ", "in", " ", "python"}], " ",
      "*)"}], "\[IndentingNewLine]", 
    RowBox[{"\[Epsilon]\[Kappa]normed", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
       "\[Epsilon]\[Kappa]", " ", "-", " ", "\[Epsilon]\[Kappa]shift"}], 
       ")"}], "/", 
      RowBox[{"FunctionArray", "[", 
       RowBox[{"\"\<ekscale\>\"", ",", "6"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simplifyTimes", "=", 
     RowBox[{"{", 
      RowBox[{"1", ",", "180"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"assumptions", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Variables", "[", 
        RowBox[{"Level", "[", 
         RowBox[{
          RowBox[{"psi", "[", "\[Epsilon]\[Kappa]normed", "]"}], " ", ",", 
          RowBox[{"{", "0", "}"}]}], "]"}], "]"}], " ", "\[Element]", " ", 
       "Reals"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetDirectory", " ", "@", " ", 
     RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt1", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"psi", "[", "\[Epsilon]\[Kappa]normed", "]"}], " ", ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<psi_val.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", 
       RowBox[{"{", "opt1", "}"}], "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt2", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"Grad", "[", 
         RowBox[{"opt1", ",", "\[Epsilon]\[Kappa]"}], "]"}], ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<psi_grad.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", "opt2", "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt3", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"Grad", "[", 
         RowBox[{"opt2", ",", "\[Epsilon]\[Kappa]"}], "]"}], ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<psi_gradhess.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"opt2", ",", "opt3"}], "}"}], ",", "True"}], "]"}]}], "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.763359331243696*^9, 3.763359366682631*^9}, {
   3.763359863845834*^9, 3.763359893836795*^9}, {3.7633599529576406`*^9, 
   3.763360010339497*^9}, {3.7633600852993*^9, 3.7633601003731003`*^9}, {
   3.763360138355579*^9, 3.7633601408424473`*^9}, {3.763360182225896*^9, 
   3.763360203487967*^9}, 3.7633615071451797`*^9, {3.7639846664624557`*^9, 
   3.763984675181531*^9}, {3.763986492008739*^9, 3.763986505449346*^9}, {
   3.763988209755965*^9, 
   3.7639882240426817`*^9}},ExpressionUUID->"61d2e58f-b248-4896-83fb-\
6b9b362760a7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "5"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.7639882265341263`*^9},ExpressionUUID->"f48e7035-b17a-4ec6-9be2-\
2048cffd514d"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.763384010366585*^9, 
  3.763384099682312*^9}},ExpressionUUID->"3c21e4c2-ae46-41c9-9847-\
ce50b672bc7c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"extrapolation", ",", " ", 
    RowBox[{"will", " ", "need", " ", "d", " ", 
     RowBox[{"Psi", "/", "d"}], " ", "ek_i", " ", "for", " ", "all", " ", "6",
      " ", "coords", " ", "and", " ", "then", " ", "also", " ", "for", " ", 
     "gradPsi", " ", "and", " ", "hessPsi"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Do", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<val d, val dd, grad d, grad dd, hess d, hess dd for \>\"", "<>", 
        RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"vald", " ", "=", " ", 
       RowBox[{"D", "[", 
        RowBox[{"opt1", ",", 
         RowBox[{"\[Epsilon]\[Kappa]", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"valdd", " ", "=", " ", 
       RowBox[{"D", "[", 
        RowBox[{"vald", ",", 
         RowBox[{"\[Epsilon]\[Kappa]", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteToFile", "[", 
       RowBox[{
        RowBox[{"\"\<psi_val_d\>\"", "<>", 
         RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<.txt\>\""}], ",", 
        " ", 
        RowBox[{"OptimizeExpressionToC", "[", 
         RowBox[{"{", 
          RowBox[{"vald", ",", "valdd"}], "}"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gradd", " ", "=", " ", 
       RowBox[{"D", "[", 
        RowBox[{"opt2", ",", 
         RowBox[{"\[Epsilon]\[Kappa]", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"graddd", " ", "=", " ", 
       RowBox[{"D", "[", 
        RowBox[{"gradd", ",", 
         RowBox[{"\[Epsilon]\[Kappa]", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteToFile", "[", 
       RowBox[{
        RowBox[{"\"\<psi_grad_d\>\"", "<>", 
         RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<.txt\>\""}], ",", 
        " ", 
        RowBox[{"OptimizeExpressionToC", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"gradd", ",", "graddd"}], "}"}], ",", " ", "True"}], 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"hessd", " ", "=", " ", 
       RowBox[{"D", "[", 
        RowBox[{"opt3", ",", 
         RowBox[{"\[Epsilon]\[Kappa]", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"hessdd", " ", "=", " ", 
       RowBox[{"D", "[", 
        RowBox[{"hessd", ",", 
         RowBox[{"\[Epsilon]\[Kappa]", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteToFile", "[", 
       RowBox[{
        RowBox[{"\"\<psi_gradhess_d\>\"", "<>", 
         RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<.txt\>\""}], ",", 
        " ", 
        RowBox[{"OptimizeExpressionToC", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"gradd", ",", "hessd", ",", "graddd", ",", "hessdd"}], 
           "}"}], ",", " ", "True"}], "]"}]}], "]"}], ";"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "6"}], "}"}]}], "\[IndentingNewLine]", 
    "]"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.763382526283826*^9, 3.7633826406426697`*^9}, {
   3.763382671138543*^9, 3.763382778625545*^9}, {3.7633828416889353`*^9, 
   3.763382871631381*^9}, {3.763382921676375*^9, 3.763383286176345*^9}, {
   3.763383945839881*^9, 3.7633840072539043`*^9}, {3.76338406507736*^9, 
   3.763384163852023*^9}, {3.763384259511291*^9, 3.763384337776773*^9}, 
   3.7634382105635357`*^9, {3.763438243401697*^9, 
   3.7634382459694757`*^9}},ExpressionUUID->"16477688-e052-435a-97f9-\
e2ae634b6d28"],

Cell[CellGroupData[{

Cell[BoxData["\<\"val d, val dd, grad d, grad dd, hess d, hess dd for \
1\"\>"], "Print",
 CellChangeTimes->{{3.7633841417390833`*^9, 3.763384166511496*^9}, 
   3.7633843470989428`*^9},ExpressionUUID->"688877f6-9885-4520-86ed-\
3d6caace0da0"],

Cell[BoxData["\<\"val d, val dd, grad d, grad dd, hess d, hess dd for \
2\"\>"], "Print",
 CellChangeTimes->{{3.7633841417390833`*^9, 3.763384166511496*^9}, 
   3.763384347101039*^9},ExpressionUUID->"6843ab0e-f371-4186-836f-\
278c912bb55c"],

Cell[BoxData["\<\"val d, val dd, grad d, grad dd, hess d, hess dd for \
3\"\>"], "Print",
 CellChangeTimes->{{3.7633841417390833`*^9, 3.763384166511496*^9}, 
   3.763384347102832*^9},ExpressionUUID->"0d93b97d-f94e-46b2-8b0a-\
905371d261b4"],

Cell[BoxData["\<\"val d, val dd, grad d, grad dd, hess d, hess dd for \
4\"\>"], "Print",
 CellChangeTimes->{{3.7633841417390833`*^9, 3.763384166511496*^9}, 
   3.7633843471046133`*^9},ExpressionUUID->"4fb3e366-5e53-4e35-8d7c-\
5747feed5036"],

Cell[BoxData["\<\"val d, val dd, grad d, grad dd, hess d, hess dd for \
5\"\>"], "Print",
 CellChangeTimes->{{3.7633841417390833`*^9, 3.763384166511496*^9}, 
   3.763384347106393*^9},ExpressionUUID->"53eafd38-442d-40cd-bc63-\
d37f5e09e7da"],

Cell[BoxData["\<\"val d, val dd, grad d, grad dd, hess d, hess dd for \
6\"\>"], "Print",
 CellChangeTimes->{{3.7633841417390833`*^9, 3.763384166511496*^9}, 
   3.763384347107773*^9},ExpressionUUID->"b96ac247-c530-46de-bad8-\
11d676394cbd"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", " ", "barrier", " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"barrier", "[", 
     RowBox[{"d_", ",", "p_"}], "]"}], " ", ":=", " ", 
    RowBox[{"bscale", " ", 
     RowBox[{"Total", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"bspeed", " ", 
           RowBox[{"d", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ")"}], "p"], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "6"}], "}"}]}], "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]\[Kappa]", " ", "=", " ", 
     RowBox[{"FunctionArray", "[", 
      RowBox[{"\"\<ek\>\"", ",", "6"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]\[Kappa]clamped", " ", "=", " ", 
     RowBox[{"FunctionArray", "[", 
      RowBox[{"\"\<ekclamped\>\"", ",", "6"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]\[Kappa]dist", " ", "=", " ", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"\[Epsilon]\[Kappa]", "[", 
           RowBox[{"[", "i", "]"}], "]"}], " ", "-", " ", 
          RowBox[{"\[Epsilon]\[Kappa]clamped", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ")"}], "/", 
        RowBox[{
         RowBox[{"FunctionArray", "[", 
          RowBox[{"\"\<ekscale\>\"", ",", "6"}], "]"}], "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "6"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simplifyTimes", "=", 
     RowBox[{"{", 
      RowBox[{"1", ",", "180"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"assumptions", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Variables", "[", 
        RowBox[{"Level", "[", 
         RowBox[{
          RowBox[{"barrier", "[", 
           RowBox[{"\[Epsilon]\[Kappa]dist", ",", "BARRIERPOWER"}], "]"}], 
          " ", ",", 
          RowBox[{"{", "0", "}"}]}], "]"}], "]"}], " ", "\[Element]", " ", 
       "Reals"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetDirectory", " ", "@", " ", 
     RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt1", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"barrier", "[", 
         RowBox[{"\[Epsilon]\[Kappa]dist", ",", "BARRIERPOWER"}], "]"}], " ", 
        ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<barrier_val.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", 
       RowBox[{"{", "opt1", "}"}], "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt2", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"Grad", "[", 
         RowBox[{"opt1", ",", "\[Epsilon]\[Kappa]"}], "]"}], ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<barrier_grad.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", "opt2", "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"opt3", " ", "=", " ", 
      RowBox[{"Quiet", "[", 
       RowBox[{"Simplify", "[", 
        RowBox[{
         RowBox[{"Grad", "[", 
          RowBox[{"opt2", ",", "\[Epsilon]\[Kappa]"}], "]"}], ",", 
         RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
         RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
     ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt3", " ", "=", 
     RowBox[{"Grad", "[", 
      RowBox[{"opt2", ",", "\[Epsilon]\[Kappa]"}], "]"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
     "avoiding", " ", "simplify", " ", "because", " ", "it", " ", 
      "simplifies", " ", "to", " ", "something", " ", "that", " ", "could", 
      " ", "be", " ", 
      RowBox[{"x", "/", "0"}], " ", 
      RowBox[{"hessian", "!"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<barrier_gradhess.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"opt2", ",", "opt3"}], "}"}], ",", 
        RowBox[{"\"\<Tuple\>\"", "\[Rule]", "True"}]}], "]"}]}], "]"}], ";"}],
    "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.763711890202764*^9, 3.7637119146905107`*^9}, {
   3.76371220608073*^9, 3.763712247831872*^9}, {3.763712283367219*^9, 
   3.763712300358861*^9}, {3.763712361190846*^9, 3.763712541485285*^9}, {
   3.763712609844548*^9, 3.76371267815589*^9}, {3.764045441384503*^9, 
   3.764045516742887*^9}, {3.7640458540612793`*^9, 3.764045862794798*^9}, {
   3.764045999779335*^9, 3.76404600118545*^9}, {3.76404794503942*^9, 
   3.7640479794372473`*^9}, 3.7640580252410717`*^9, {3.7640591070925303`*^9, 
   3.7640591437236032`*^9}, 
   3.764074503200852*^9},ExpressionUUID->"8e14a896-3474-4389-98a3-\
4fdea547e4b4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"compression", " ", "term"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"PY", ":", " ", 
     RowBox[{
      RowBox[{"C", "[", "0", "]"}], "*", 
      RowBox[{"1.0", "/", 
       RowBox[{"np", ".", "maximum"}]}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"EXX", "*", "EYY"}], "+", 
          RowBox[{"C", "[", "1", "]"}]}], ")"}], ",", 
        RowBox[{
         RowBox[{"1", "e"}], "-", "10"}]}], ")"}]}]}], ",", " ", 
    RowBox[{
    "input", " ", "is", " ", "not", " ", "normalized", " ", "bc", " ", "need",
      " ", "physical", " ", "info"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"CPP", " ", 
     RowBox[{"vars", ":", " ", "Ccompr0"}]}], ",", "Ccompr1"}], " ", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Epsilon]\[Kappa]", " ", "=", " ", 
     RowBox[{"FunctionArray", "[", 
      RowBox[{"\"\<ek\>\"", ",", "6"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"compr", " ", "=", " ", 
     RowBox[{"Ccompr0", " ", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Epsilon]\[Kappa]", "[", 
           RowBox[{"[", "1", "]"}], "]"}], 
          RowBox[{"\[Epsilon]\[Kappa]", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "+", "Ccompr1"}], ")"}]}]}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simplifyTimes", "=", 
     RowBox[{"{", 
      RowBox[{"1", ",", "180"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"assumptions", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Variables", "[", 
        RowBox[{"Level", "[", 
         RowBox[{"compr", ",", 
          RowBox[{"{", "0", "}"}]}], "]"}], "]"}], " ", "\[Element]", " ", 
       "Reals"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetDirectory", " ", "@", " ", 
     RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt1", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{"compr", " ", ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<compr_val.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", 
       RowBox[{"{", "opt1", "}"}], "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt2", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"Grad", "[", 
         RowBox[{"opt1", ",", "\[Epsilon]\[Kappa]"}], "]"}], ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<compr_grad.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", "opt2", "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt3", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"Grad", "[", 
         RowBox[{"opt2", ",", "\[Epsilon]\[Kappa]"}], "]"}], ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<compr_gradhess.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"opt2", ",", "opt3"}], "}"}], ",", 
        RowBox[{"\"\<Tuple\>\"", "\[Rule]", "True"}]}], "]"}]}], "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7640740496222486`*^9, 3.764074080725275*^9}, {
  3.764074117716062*^9, 3.764074119283681*^9}, {3.764074203860056*^9, 
  3.764074223099187*^9}, {3.764074278498392*^9, 3.7640743082338057`*^9}, {
  3.764074449816517*^9, 
  3.76407462918114*^9}},ExpressionUUID->"e4cd5d25-8782-4ef6-84ea-\
0c76aecf7a63"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.763382517218192*^9, 3.763382518203182*^9}, 
   3.764058721183712*^9, 
   3.764074044250834*^9},ExpressionUUID->"160a8d72-e357-456b-856f-\
0603505aa090"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"data", "-", 
    RowBox[{"driven", " ", "energy", "  ", "OLD"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"nprimitives", "=", "6"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nprimitivecoeffs", " ", "=", " ", "5"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Cpsi", " ", "=", " ", 
     RowBox[{"FunctionArray", "[", 
      RowBox[{"\"\<C\>\"", ",", 
       RowBox[{"1", "+", 
        RowBox[{"nprimitives", "*", "nprimitivecoeffs"}]}]}], "]"}]}], ";"}], 
   " ", 
   RowBox[{"(*", " ", 
    RowBox[{"constant", " ", "+", " ", 
     RowBox[{
     "6", " ", "primitives", " ", "with", " ", "each", " ", "5", " ", 
      "coeffs"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]\[Kappa]", " ", "=", " ", 
     RowBox[{"FunctionArray", "[", 
      RowBox[{"\"\<ek\>\"", ",", "6"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]\[Kappa]normed", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"\[Epsilon]\[Kappa]", " ", "-", " ", 
        RowBox[{"FunctionArray", "[", 
         RowBox[{"\"\<ekshift\>\"", ",", "6"}], "]"}]}], ")"}], "/", 
      RowBox[{"FunctionArray", "[", 
       RowBox[{"\"\<ekscale\>\"", ",", "6"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Eta]", "[", 
      RowBox[{"Ceta_", ",", " ", "X_"}], "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"Ceta", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "+", 
      RowBox[{
       RowBox[{"Ceta", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "*", "X"}], "+", 
      RowBox[{
       RowBox[{"Ceta", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{"X", "^", "2"}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"Ceta", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{"X", "^", "3"}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"Ceta", "[", 
        RowBox[{"[", "5", "]"}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{"X", "^", "4"}], ")"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", 
      RowBox[{"Cpsi_", ",", " ", "ek_"}], "]"}], " ", ":=", " ", 
     RowBox[{"s", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Cpsi", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "+", 
        RowBox[{"Total", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"\[Eta]", "[", 
            RowBox[{
             RowBox[{"Cpsi", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"2", "+", 
                 RowBox[{"5", "*", "i"}]}], ";;", 
                RowBox[{"2", "+", 
                 RowBox[{"5", "*", 
                  RowBox[{"(", 
                   RowBox[{"i", "+", "1"}], ")"}]}], "-", "1"}]}], "]"}], 
              "]"}], ",", " ", 
             RowBox[{"ek", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "5"}], "}"}]}], "]"}], "]"}]}], 
       ")"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"\[Psi]", "[", 
    RowBox[{"Cpsi", ",", "\[Epsilon]\[Kappa]normed"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"simplifyTimes", "=", 
     RowBox[{"{", 
      RowBox[{"1", ",", "180"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"assumptions", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Variables", "[", 
        RowBox[{"Level", "[", 
         RowBox[{
          RowBox[{"\[Psi]", "[", 
           RowBox[{"Cpsi", ",", "\[Epsilon]\[Kappa]normed"}], "]"}], " ", ",", 
          RowBox[{"{", 
           RowBox[{"-", "2"}], "}"}]}], "]"}], "]"}], " ", "\[Element]", " ", 
       "Reals"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetDirectory", " ", "@", " ", 
     RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt1", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Psi]", "[", 
          RowBox[{"Cpsi", ",", "\[Epsilon]\[Kappa]normed"}], "]"}], "}"}], 
        " ", ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<psi_val.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", "opt1", "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt2", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"Grad", "[", 
         RowBox[{
          RowBox[{"\[Psi]", "[", 
           RowBox[{"Cpsi", ",", "\[Epsilon]\[Kappa]normed"}], "]"}], ",", 
          "\[Epsilon]\[Kappa]"}], "]"}], ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<psi_grad.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", "opt2", "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"opt3", " ", "=", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"Grad", "[", 
         RowBox[{"opt2", ",", "\[Epsilon]\[Kappa]"}], "]"}], ",", 
        RowBox[{"TimeConstraint", "\[Rule]", "simplifyTimes"}], ",", " ", 
        RowBox[{"Assumptions", "\[Rule]", "assumptions"}]}], "]"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteToFile", "[", 
     RowBox[{"\"\<psi_gradhess.txt\>\"", ",", " ", 
      RowBox[{"OptimizeExpressionToC", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"opt2", ",", "opt3"}], "}"}], ",", "True"}], "]"}]}], "]"}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Debugging", " ", "/", " ", "Experimenting"}], " ", "Zone"}], 
    " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.75411126019691*^9, 3.754111267334103*^9}, {
   3.7558559357868423`*^9, 3.7558560539307327`*^9}, {3.755856092546006*^9, 
   3.755856168471343*^9}, {3.755856389181508*^9, 3.755856393156547*^9}, {
   3.7558564876439447`*^9, 3.755856536475424*^9}, {3.755856572963526*^9, 
   3.755856629875971*^9}, {3.755856780306368*^9, 3.755856874310699*^9}, {
   3.755856975005465*^9, 3.755857055507648*^9}, {3.755857103011653*^9, 
   3.755857194314335*^9}, {3.75585736724963*^9, 3.755857409752245*^9}, {
   3.755857489431953*^9, 3.75585771451746*^9}, {3.7558577493475723`*^9, 
   3.7558577523555527`*^9}, {3.755857894957049*^9, 3.7558579325137987`*^9}, {
   3.755857969457891*^9, 3.755858035520541*^9}, {3.755858176567773*^9, 
   3.7558581792483873`*^9}, {3.755858710351268*^9, 3.7558587434472647`*^9}, {
   3.755859035886235*^9, 3.7558591418492203`*^9}, {3.755859629886897*^9, 
   3.7558596504678907`*^9}, {3.7558597379085407`*^9, 3.755859830832266*^9}, {
   3.755859903096593*^9, 3.755859941064476*^9}, {3.755860179339991*^9, 
   3.7558602258832293`*^9}, {3.755860398313758*^9, 3.755860571174759*^9}, {
   3.755860614465536*^9, 3.7558607337159367`*^9}, {3.755860833395479*^9, 
   3.75586086426725*^9}, {3.755861174063393*^9, 3.7558612210547237`*^9}, {
   3.75586133025352*^9, 3.755861330920206*^9}, {3.7558613650391827`*^9, 
   3.7558613807885323`*^9}, 3.755861424217703*^9, {3.75586223017262*^9, 
   3.755862230938295*^9}, {3.7558622891083717`*^9, 3.755862348544795*^9}, {
   3.7558623835209312`*^9, 3.755862384743754*^9}, {3.755866764426113*^9, 
   3.755866765672069*^9}, {3.755866799932543*^9, 3.75586681772995*^9}, {
   3.755867831616547*^9, 3.7558678362176037`*^9}, {3.761284736366868*^9, 
   3.761284844733822*^9}, {3.7633593279406443`*^9, 3.763359328820022*^9}, {
   3.763359437073978*^9, 3.763359442393756*^9}, {3.763359766781715*^9, 
   3.763359813581287*^9}, 
   3.763359861396901*^9},ExpressionUUID->"3e7e2a88-e90f-4b35-8ccc-\
0a8b67bcba39"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Experimental`OptimizeExpression", "[", 
    RowBox[{"{", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sin", "[", 
         RowBox[{"3", "x"}], "]"}], "<", "10"}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", "BARRIERPOWER"}], ")"}], " ", 
        "BARRIERPOWER", " ", "bscale", " ", 
        SuperscriptBox["bspeed", "2"]}], " ", ",", "0"}], "]"}], "}"}], "]"}],
    "\[IndentingNewLine]", " ", 
   RowBox[{"OptimizeExpressionToC", "[", 
    RowBox[{"{", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sin", "[", 
         RowBox[{"3", "x"}], "]"}], "<", "10"}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", "BARRIERPOWER"}], ")"}], " ", 
        "BARRIERPOWER", " ", "bscale", " ", 
        SuperscriptBox["bspeed", "2"]}], " ", ",", "0"}], "]"}], "}"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.764059091945003*^9, 
  3.764059092795539*^9}},ExpressionUUID->"255b8617-9318-45ae-ae2d-\
c4057278857b"],

Cell[BoxData[
 RowBox[{"Experimental`OptimizedExpression", "[", 
  RowBox[{"{", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Sin", "[", 
       RowBox[{"3", " ", "x"}], "]"}], "<", "10"}], ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "1"}], "+", "BARRIERPOWER"}], ")"}], " ", "BARRIERPOWER",
       " ", "bscale", " ", 
      SuperscriptBox["bspeed", "2"]}], ",", "0"}], "]"}], "}"}], 
  "]"}]], "Output",
 CellChangeTimes->{
  3.7640590932025537`*^9},ExpressionUUID->"8c9dd0db-e8d8-4dc7-a217-\
38f78c554edd"],

Cell[BoxData[
 TemplateBox[{
  "Part","partw",
   "\"Part \\!\\(\\*RowBox[{\\\"2\\\"}]\\) of \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{\\\"If\\\", \\\"[\\\", RowBox[{RowBox[{RowBox[{\\\"Sin\\\", \
\\\"[\\\", RowBox[{\\\"3\\\", \\\" \\\", \\\"x\\\"}], \\\"]\\\"}], \\\"<\\\", \
\\\"10\\\"}], \\\",\\\", RowBox[{RowBox[{\\\"copt4\\\", \\\"=\\\", \
SuperscriptBox[\\\"bspeed\\\", \\\"2\\\"]}], \\\";\\\", RowBox[{RowBox[{\\\"(\
\\\", RowBox[{RowBox[{\\\"-\\\", \\\"1\\\"}], \\\"+\\\", \
\\\"BARRIERPOWER\\\"}], \\\")\\\"}], \\\" \\\", \\\"BARRIERPOWER\\\", \\\" \\\
\", \\\"bscale\\\", \\\" \\\", \\\"copt4\\\"}]}], \\\",\\\", \\\"0\\\"}], \
\\\"]\\\"}], \\\"}\\\"}]\\) does not exist.\"",2,72,55,23312471348796023427,
   "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.764059093211738*^9},ExpressionUUID->"f00d1ff1-93a9-40ae-86bc-\
35918b7b7363"],

Cell[BoxData[
 TemplateBox[{
  "Part","pspec1",
   "\"Part specification \\!\\(\\*RowBox[{\\\"\\\\\\\"out(1) = \
1;\\\\\\\\n\\\\\\\"\\\"}]\\) is not applicable.\"",2,72,56,
   23312471348796023427,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.764059093218095*^9},ExpressionUUID->"d956dc7f-92e9-421f-9276-\
c90bd9d9097e"],

Cell[BoxData[
 TemplateBox[{
  "Join","heads",
   "\"Heads \\!\\(\\*RowBox[{\\\"List\\\"}]\\) and \
\\!\\(\\*RowBox[{\\\"Part\\\"}]\\) at positions \
\\!\\(\\*RowBox[{\\\"1\\\"}]\\) and \\!\\(\\*RowBox[{\\\"2\\\"}]\\) are \
expected to be the same.\"",2,72,57,23312471348796023427,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.764059093223009*^9},ExpressionUUID->"33cb5466-c3cb-4a05-93ce-\
0546b915a506"],

Cell[BoxData[
 TemplateBox[{
  "StringReplace","strse",
   "\"String or list of strings expected at position \\!\\(\\*RowBox[{\\\"1\\\
\"}]\\) in \\!\\(\\*RowBox[{\\\"StringReplace\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"Join\\\", \\\"[\\\", RowBox[{RowBox[{\\\"{\\\", \
\\\"\\\\\\\"Real Sin(3*x) < 10 = (-1 + \
BARRIERPOWER)*BARRIERPOWER*bscale*Power(bspeed,2);\\\\\\\\n\\\\\\\"\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"\\\\\\\"out(0) = \
Experimental_OptimizedExpression(Block(List(copt4),List(If(Sin(3*x) < \
10,(copt4 = Power(bspeed,2),(-1 + \
BARRIERPOWER)*BARRIERPOWER*bscale*copt4),0))));\\\\\\\\n\\\\\\\"\\\", \\\"\
\[LeftDoubleBracket]\\\", RowBox[{\\\"\\\\\\\"out(1) = \
1;\\\\\\\\n\\\\\\\"\\\", \\\",\\\", \\\"\\\\\\\"out(2) = \
2;\\\\\\\\n\\\\\\\"\\\", \\\",\\\", \\\"\\\\\\\"out(3) = \
2;\\\\\\\\n\\\\\\\"\\\"}], \\\"\[RightDoubleBracket]\\\"}]}], \\\"]\\\"}], \\\
\",\\\", RowBox[{\\\"\\\\\\\"Power(E,\\\\\\\"\\\", \\\"\[Rule]\\\", \
\\\"\\\\\\\"Exp(\\\\\\\"\\\"}]}], \\\"]\\\"}]\\).\"",2,72,58,
   23312471348796023427,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.764059093229059*^9},ExpressionUUID->"6baa00c4-bf35-4e68-b05a-\
1ff65e2a1d83"],

Cell[BoxData[
 TemplateBox[{
  "StringJoin","string",
   "\"String expected at position \\!\\(\\*RowBox[{\\\"1\\\"}]\\) in \
\\!\\(\\*RowBox[{\\\"StringJoin\\\", \\\"[\\\", \
RowBox[{\\\"StringReplace\\\", \\\"[\\\", RowBox[{RowBox[{\\\"Join\\\", \\\"[\
\\\", RowBox[{RowBox[{\\\"{\\\", \\\"\\\\\\\"Real Sin(3*x) < 10 = (-1 + \
BARRIERPOWER)*BARRIERPOWER*bscale*Power(bspeed,2);\\\\\\\\n\\\\\\\"\\\", \
\\\"}\\\"}], \\\",\\\", RowBox[{\\\"\\\\\\\"out(0) = \
Experimental_OptimizedExpression(Block(List(copt4),List(If(Sin(3*x) < \
10,(copt4 = Power(bspeed,2),(-1 + \
BARRIERPOWER)*BARRIERPOWER*bscale*copt4),0))));\\\\\\\\n\\\\\\\"\\\", \\\"\
\[LeftDoubleBracket]\\\", RowBox[{\\\"\\\\\\\"out(1) = \
1;\\\\\\\\n\\\\\\\"\\\", \\\",\\\", \\\"\\\\\\\"out(2) = \
2;\\\\\\\\n\\\\\\\"\\\", \\\",\\\", \\\"\\\\\\\"out(3) = \
2;\\\\\\\\n\\\\\\\"\\\"}], \\\"\[RightDoubleBracket]\\\"}]}], \\\"]\\\"}], \\\
\",\\\", RowBox[{\\\"\\\\\\\"Power(E,\\\\\\\"\\\", \\\"\[Rule]\\\", \
\\\"\\\\\\\"Exp(\\\\\\\"\\\"}]}], \\\"]\\\"}], \\\"]\\\"}]\\).\"",2,72,59,
   23312471348796023427,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.76405909323525*^9},ExpressionUUID->"a8b5fa94-6368-4567-a0fb-bf787915bc69"],

Cell[BoxData[
 RowBox[{"StringJoin", "[", 
  RowBox[{"StringReplace", "[", 
   RowBox[{
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{
      "{", "\<\"Real Sin(3*x) < 10 = (-1 + \
BARRIERPOWER)*BARRIERPOWER*bscale*Power(bspeed,2);\\n\"\>", "}"}], ",", 
      RowBox[{"\<\"out(0) = \
Experimental_OptimizedExpression(Block(List(copt4),List(If(Sin(3*x) < \
10,(copt4 = Power(bspeed,2),(-1 + \
BARRIERPOWER)*BARRIERPOWER*bscale*copt4),0))));\\n\"\>", 
       "\[LeftDoubleBracket]", 
       RowBox[{"\<\"out(1) = 1;\\n\"\>", ",", "\<\"out(2) = 2;\\n\"\>", 
        ",", "\<\"out(3) = 2;\\n\"\>"}], "\[RightDoubleBracket]"}]}], "]"}], 
    ",", 
    RowBox[{"\<\"Power(E,\"\>", "\[Rule]", "\<\"Exp(\"\>"}]}], "]"}], 
  "]"}]], "Output",
 CellChangeTimes->{
  3.764059093236431*^9},ExpressionUUID->"5db02a8d-247e-4dcf-aced-\
715b6040c893"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"myfun", "[", "a_", "]"}], " ", ":=", " ", 
     RowBox[{"myarray", "[", "a", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"myfun", "[", "0", "]"}], "\[IndentingNewLine]", 
   RowBox[{"OptimizeExpressionToC", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"3", "x"}], ",", " ", 
       RowBox[{"Sin", "[", 
        RowBox[{"3", "x"}], "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Cos", "[", "x", "]"}], "^", "2"}], " ", "+", " ", 
        RowBox[{"Sin", "[", "x", "]"}], " ", "+", " ", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"3", "x"}], "]"}], "^", "2"}], " ", "+", " ", 
        SuperscriptBox[
         RowBox[{"myfun", "[", "0", "]"}], "2"], "+", " ", 
        SuperscriptBox[
         RowBox[{"myfun", "[", "1", "]"}], "2"], "+", " ", 
        RowBox[{"myfun", "[", "1", "]"}]}]}], "}"}], ",", " ", 
     RowBox[{"\"\<Pow2\>\"", "\[Rule]", "True"}], ",", 
     RowBox[{"ExcludedForms", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"myarray", ",", "myfun", ",", "Sin"}], "}"}]}]}], "]"}], " ", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"doesnt", " ", "work"}], ",", " ", 
     RowBox[{"still", " ", "evaluates", " ", "myarray"}]}], "*)"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{
  3.763357197723852*^9, {3.7633572803245077`*^9, 3.763357296059574*^9}, {
   3.7633573457393*^9, 3.763357412907071*^9}, {3.763357444970701*^9, 
   3.76335744573246*^9}, {3.763357498818316*^9, 3.763357593747417*^9}, 
   3.76335773282386*^9, {3.763357772151532*^9, 3.763357791703197*^9}, {
   3.76335791713402*^9, 3.763357946316532*^9}, {3.763357990366625*^9, 
   3.763358025005121*^9}, {3.7633580623976707`*^9, 3.763358102067155*^9}, {
   3.7633582434326344`*^9, 3.763358284984235*^9}, {3.763358340127791*^9, 
   3.763358381639016*^9}, {3.763358414273407*^9, 3.763358573437722*^9}, {
   3.7633586123198*^9, 3.763358828913397*^9}, {3.763359081382806*^9, 
   3.763359240827609*^9}, 3.763359340550156*^9, {3.764056476876539*^9, 
   3.764056718704608*^9}},ExpressionUUID->"21e8f103-87d1-4bf6-9114-\
992f7095dff3"],

Cell[BoxData[
 RowBox[{"myarray", "[", "0", "]"}]], "Output",
 CellChangeTimes->{{3.764056564976034*^9, 
  3.764056720118162*^9}},ExpressionUUID->"47b412f0-2f1e-4b6f-a715-\
5ffde8f14074"],

Cell[BoxData["\<\"Real copt3 = Cos(x);\\nReal copt4 = (copt3*copt3);\\nReal \
copt5 = myarray(0);\\nReal copt6 = (copt5*copt5);\\nReal copt8 = \
myarray(1);\\nReal copt9 = (copt8*copt8);\\nReal copt11 = Sin(3*x);\\nReal \
copt12 = (copt11*copt11);\\nout(0) = 3*x;\\nout(1) = Sin(3*x);\\nout(2) = \
copt12 + copt4 + copt6 + copt9 + myarray(1) + Sin(x);\\n\"\>"], "Output",
 CellChangeTimes->{{3.764056564976034*^9, 
  3.764056720120172*^9}},ExpressionUUID->"46f1677f-1e2a-4b53-ad8a-\
0a1334457c89"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"OptimizeExpressionToC", "[", 
  RowBox[{"{", 
   RowBox[{"psi", "[", "x", "]"}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.7633592748433857`*^9, 
  3.763359282077241*^9}},ExpressionUUID->"4bca066b-acf3-431e-afb2-\
0d90de032b54"],

Cell[BoxData["\<\"Real c1 = x(1);\\nReal c9 = x(0);\\nReal c16 = Power(c1,2);\
\\nReal c11 = Power(c9,2);\\nReal c21 = Power(c1,3);\\nReal c26 = \
x(2);\\nReal c14 = Power(c9,3);\\nReal c31 = Power(c26,2);\\nReal c35 = \
Power(c26,3);\\nReal c40 = x(3);\\nReal c49 = Power(c40,2);\\nReal c55 = \
Power(c40,3);\\nReal c61 = x(4);\\nReal c72 = Power(c61,2);\\nReal c80 = \
Power(c61,3);\\nReal c87 = x(5);\\nReal c98 = Power(c87,2);\\nReal c106 = \
Power(c87,3);\\nReal c113 = x(6);\\nout(0) = C0 + C11*c1 + C14*Power(c1,4) + \
C53*c106 + C0121*c1*c11 + C61*c113 + C62*Power(c113,2) + C63*Power(c113,3) + \
C64*Power(c113,4) + C0131*c1*c14 + C12*c16 + C0122*c11*c16 + C13*c21 + \
C21*c26 + C2513*c106*c26 + C0221*c11*c26 + C0231*c14*c26 + C24*Power(c26,4) + \
C22*c31 + C0222*c11*c31 + C23*c35 + C31*c40 + C3513*c106*c40 + C0321*c11*c40 \
+ C0331*c14*c40 + C2311*c26*c40 + C2321*c31*c40 + C2331*c35*c40 + \
C34*Power(c40,4) + C32*c49 + C0322*c11*c49 + C2312*c26*c49 + C2322*c31*c49 + \
C33*c55 + C2313*c26*c55 + C41*c61 + C0421*c11*c61 + C0431*c14*c61 + \
C2411*c26*c61 + C2421*c31*c61 + C2431*c35*c61 + C3411*c40*c61 + C3421*c49*c61 \
+ C3431*c55*c61 + C44*Power(c61,4) + C42*c72 + C0422*c11*c72 + C2412*c26*c72 \
+ C2422*c31*c72 + C3412*c40*c72 + C3422*c49*c72 + C43*c80 + C2413*c26*c80 + \
C3413*c40*c80 + C51*c87 + C0521*c11*c87 + C0531*c14*c87 + C2511*c26*c87 + \
C2521*c31*c87 + C2531*c35*c87 + C3511*c40*c87 + C3521*c49*c87 + C3531*c55*c87 \
+ C54*Power(c87,4) + C0111*c1*c9 + C0513*c106*c9 + C0112*c16*c9 + \
C0113*c21*c9 + C0211*c26*c9 + C0212*c31*c9 + C0213*c35*c9 + C0311*c40*c9 + \
C0312*c49*c9 + C0313*c55*c9 + C0411*c61*c9 + C0412*c72*c9 + C0413*c80*c9 + \
C0511*c87*c9 + C52*c98 + C0522*c11*c98 + C2512*c26*c98 + C2522*c31*c98 + \
C3512*c40*c98 + C3522*c49*c98 + C0512*c9*c98;\\n\"\>"], "Output",
 CellChangeTimes->{
  3.7633592824362297`*^9},ExpressionUUID->"10d18bf2-bbb1-4dc1-a1c8-\
5d290fc0eb6e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"intQ", "=", 
   RowBox[{
    RowBox[{"IntegerQ", "@", 
     RowBox[{"Rationalize", "@", "#"}]}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"intQ", "[", "1.0000000001", "]"}]}], "Input",
 CellChangeTimes->{{3.764045701395204*^9, 3.764045712657514*^9}, {
  3.7640457495541077`*^9, 
  3.7640457573053007`*^9}},ExpressionUUID->"6da22d02-59b5-4126-bded-\
b4be1a9f5e50"],

Cell[BoxData["False"], "Output",
 CellChangeTimes->{{3.764045754186447*^9, 
  3.7640457575180683`*^9}},ExpressionUUID->"4c034293-dd26-4ea5-b107-\
3ab1e1840182"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Angle", "[", 
      RowBox[{"u_", ",", "v_"}], "]"}], ":=", " ", 
     RowBox[{"ArcTan", "[", 
      RowBox[{
       RowBox[{"u", ".", "v"}], ",", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"v", "\[Cross]", "u"}], ")"}], ".", 
        RowBox[{"Normalize", "[", 
         RowBox[{"Cross", "[", 
          RowBox[{"u", ",", "v"}], "]"}], "]"}]}]}], "]"}]}], ";"}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", "u"}], "}"}], "]"}], "]"}],
          ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", "v"}], "}"}], "]"}], "]"}],
          ",", " ", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "2"}], ",", 
             RowBox[{"-", "2"}], ",", "2", ",", "2"}], "}"}], "}"}]}]}], 
        "]"}], ",", " ", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Angle", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"u", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"u", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"v", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"v", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}]}], "]"}], " ", 
        "*", " ", 
        RowBox[{"180", "/", "Pi"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"Normalize", "[", 
        RowBox[{"Cross", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"u", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"u", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"v", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"v", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}]}], "]"}], 
        "]"}]}], " ", "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", 
     ",", 
     RowBox[{"{", 
      RowBox[{"u", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", 
         RowBox[{"-", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"v", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", 
         RowBox[{"-", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}], "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.764928438215755*^9, 3.764928566127294*^9}, {
  3.764928605512644*^9, 3.7649286340622807`*^9}, {3.7649286806469717`*^9, 
  3.764928683981387*^9}, {3.764928796325986*^9, 3.764928804246889*^9}, {
  3.7649288978035593`*^9, 3.764928897938846*^9}, {3.764929021842718*^9, 
  3.7649290421612864`*^9}, {3.764929117825388*^9, 
  3.7649291281037903`*^9}},ExpressionUUID->"e9909e52-d29c-4e3e-a46d-\
b6e1585d461c"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`u$$ = {-0.6499999999999999, 
    0.30000000000000004`}, $CellContext`v$$ = {-1, 0.07000000000000006}, 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`u$$], {-1, -1}, {1, 1}}, {
      Hold[$CellContext`v$$], {-1, -1}, {1, 1}}}, Typeset`size$$ = {
    373., {88., 92.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`u$18557$$ = {0, 
    0}, $CellContext`v$18558$$ = {0, 0}}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`u$$ = {-1, -1}, $CellContext`v$$ = {-1, \
-1}}, "ControllerVariables" :> {
        Hold[$CellContext`u$$, $CellContext`u$18557$$, {0, 0}], 
        Hold[$CellContext`v$$, $CellContext`v$18558$$, {0, 0}]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> {
        Show[
         Graphics[
          Arrow[{{0, 0}, $CellContext`u$$}]], 
         Graphics[
          Arrow[{{0, 0}, $CellContext`v$$}]], 
         PlotRange -> {{-2, -2, 2, 2}}], $CellContext`Angle[{
           Part[$CellContext`u$$, 1], 
           Part[$CellContext`u$$, 2], 0}, {
           Part[$CellContext`v$$, 1], 
           Part[$CellContext`v$$, 2], 0}] (180/Pi), 
        Normalize[
         Cross[{
           Part[$CellContext`u$$, 1], 
           Part[$CellContext`u$$, 2], 0}, {
           Part[$CellContext`v$$, 1], 
           Part[$CellContext`v$$, 2], 0}]]}, 
      "Specifications" :> {{$CellContext`u$$, {-1, -1}, {1, 
         1}}, {$CellContext`v$$, {-1, -1}, {1, 1}}}, "Options" :> {}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{420., {204., 209.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.7649284688430777`*^9, 3.764928504599106*^9, {3.764928548234037*^9, 
   3.764928566485096*^9}, {3.76492861379401*^9, 3.7649286351973677`*^9}, 
   3.76492868433836*^9, 3.7649288055619087`*^9, 3.7649290510924*^9, 
   3.764929128498773*^9},ExpressionUUID->"4df4503d-ec0c-483a-9e1a-\
0503823cd5d4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "checking", " ", "if", " ", "the", " ", "normalize", " ", "is", " ", 
    "important", " ", "in", " ", "arctan"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"XX0", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"XX1", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0.4", ",", "0"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"curvetst", " ", "=", " ", "0.1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"XX2", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.3"}], ",", "0.2", ",", "curvetst"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"XXN0", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0.3", ",", "0.2", ",", "curvetst"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"Graphics3D", "[", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"Triangle", "[", 
         RowBox[{"{", 
          RowBox[{"XX0", ",", "XX1", ",", "XX2"}], "}"}], "]"}], " ", ",", 
        " ", 
        RowBox[{"Triangle", "[", 
         RowBox[{"{", 
          RowBox[{"XX0", ",", "XXN0", ",", "XX1"}], "}"}], "]"}]}], "}"}], 
      "  ", "]"}], ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.5"}], ",", "0.5"}], "}"}]}]}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NNN", " ", "=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"XX1", "-", "XX0"}], ")"}], "\[Cross]", 
       RowBox[{"(", 
        RowBox[{"XX2", "-", "XX0"}], ")"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NNN0", " ", "=", " ", 
     RowBox[{"Normalize", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"XXN0", "-", "XX0"}], ")"}], "\[Cross]", 
       RowBox[{"(", 
        RowBox[{"XX1", "-", "XX0"}], ")"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ArcTan", "[", 
     RowBox[{
      RowBox[{"NNN", ".", "NNN0"}], ",", 
      RowBox[{
       RowBox[{"Normalize", "[", 
        RowBox[{"(", 
         RowBox[{"XX1", "-", "XX0"}], ")"}], "]"}], ".", 
       RowBox[{"(", 
        RowBox[{"NNN", "\[Cross]", "NNN0"}], ")"}]}]}], "]"}], " ", "*", " ", 
    RowBox[{"180", "/", "Pi"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Angle", "[", 
      RowBox[{"u_", ",", "v_", ",", " ", "n_"}], "]"}], ":=", " ", 
     RowBox[{"ArcTan", "[", 
      RowBox[{
       RowBox[{"u", ".", "v"}], ",", 
       RowBox[{"n", ".", " ", 
        RowBox[{"Cross", "[", 
         RowBox[{"u", ",", "v"}], "]"}]}]}], "]"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"note", " ", "that", " ", "mathematica", " ", "arctan", 
       RowBox[{"(", 
        RowBox[{"x", ",", "y"}], ")"}], " ", "vs", " ", "cpp", " ", "atan2", 
       RowBox[{"(", 
        RowBox[{"y", ",", "x"}], ")"}]}], ",", " ", 
      RowBox[{"assume", " ", "normalized", " ", "u", " ", "v", " ", "n"}]}], 
     " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Angle", "[", 
      RowBox[{"NNN", ",", "NNN0", ",", " ", 
       RowBox[{"Normalize", "[", 
        RowBox[{"XX1", "-", " ", "XX0"}], "]"}]}], "]"}], "*", " ", 
     RowBox[{"180", "/", "Pi"}]}]}]}]}]], "Input",
 CellChangeTimes->{{3.764929445082176*^9, 3.764929969288125*^9}, {
  3.764930172675748*^9, 
  3.7649302292597523`*^9}},ExpressionUUID->"a6c7baea-a9e5-4acc-bb64-\
078d37c23558"],

Cell[BoxData[
 Graphics3DBox[{
   TagBox[Polygon3DBox[{{0, 0, 0}, {0, 0.4, 0}, {-0.3, 0.2, 0.1}}],
    "Triangle"], 
   TagBox[Polygon3DBox[{{0, 0, 0}, {0.3, 0.2, 0.1}, {0, 0.4, 0}}],
    "Triangle"]},
  ImageSize->{278.9438048308543, 431.0154586347365},
  PlotRange->{-0.5, 0.5},
  ViewPoint->{0.13673324233466824`, -3.3324386532335932`, 0.5711012544858584},
  ViewVertical->{0.081397744327762, -1.0676031655875748`, 
   0.8941666566741109}]], "Output",
 CellChangeTimes->{
  3.764929792654377*^9, {3.764929888540386*^9, 3.764929945304617*^9}, {
   3.7649301956142673`*^9, 
   3.764930229512924*^9}},ExpressionUUID->"12e6d578-d77f-498c-9367-\
7f951b42fe95"],

Cell[BoxData[
 RowBox[{"-", "36.86989764584403`"}]], "Output",
 CellChangeTimes->{
  3.764929792654377*^9, {3.764929888540386*^9, 3.764929945304617*^9}, {
   3.7649301956142673`*^9, 
   3.764930229514509*^9}},ExpressionUUID->"82c6e2f1-6049-4eb1-b8ab-\
ae9706dc874b"],

Cell[BoxData[
 RowBox[{"-", "36.86989764584403`"}]], "Output",
 CellChangeTimes->{
  3.764929792654377*^9, {3.764929888540386*^9, 3.764929945304617*^9}, {
   3.7649301956142673`*^9, 
   3.764930229533575*^9}},ExpressionUUID->"8469ccd3-277d-47d2-912e-\
0abc20507abb"]
}, Open  ]]
},
WindowSize->{1869, 1145},
WindowMargins->{{0, Automatic}, {Automatic, 30}},
FrontEndVersion->"11.1 for Linux x86 (64-bit) (March 13, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 156, 3, 32, "Input", "ExpressionUUID" -> \
"ce7a8f21-2a7b-4df1-9a21-5d4ea3d14c5d"],
Cell[717, 25, 13769, 331, 699, "Input", "ExpressionUUID" -> \
"3612ea70-5f38-4e37-bd1b-6c0b5a9bdcae"],
Cell[14489, 358, 376, 6, 32, "Input", "ExpressionUUID" -> \
"0fb39144-7c88-4dd5-b471-a89bfeaad29d"],
Cell[14868, 366, 11400, 288, 673, "Input", "ExpressionUUID" -> \
"4776e7ad-a76c-49e4-b3e9-6cbde6d13ec3"],
Cell[CellGroupData[{
Cell[26293, 658, 4475, 96, 328, "Input", "ExpressionUUID" -> \
"db2d1574-3286-468b-8744-a23c0c930e49"],
Cell[30771, 756, 516, 8, 32, "Output", "ExpressionUUID" -> \
"4b556933-a119-491d-9869-f5c66a605fbc"],
Cell[31290, 766, 543, 10, 34, "Output", "ExpressionUUID" -> \
"d4537437-a6d6-4a7f-81fe-225b8dec9e9d"],
Cell[31836, 778, 554, 10, 34, "Output", "ExpressionUUID" -> \
"4aa095ed-aab4-46c6-97b2-abfbe5abe313"]
}, Open  ]],
Cell[32405, 791, 177, 3, 32, "Input", "ExpressionUUID" -> \
"83828bfb-ee37-4639-8b6c-321bc715f6f6"],
Cell[32585, 796, 3423, 97, 147, "Input", "ExpressionUUID" -> \
"34057c6a-bdd5-48dc-bdfb-ca87f3c47be6"],
Cell[36011, 895, 3925, 104, 148, "Input", "ExpressionUUID" -> \
"eb0f7c7c-29e0-4630-8951-518f9428c379"],
Cell[39939, 1001, 3297, 78, 218, "Input", "ExpressionUUID" -> \
"ad57a804-d84a-4d8b-b266-2a66855df4a3"],
Cell[43239, 1081, 2695, 75, 149, "Input", "ExpressionUUID" -> \
"409b12fd-5167-44d1-93b6-286f6585bbfd"],
Cell[45937, 1158, 81, 0, 32, "Input", "ExpressionUUID" -> \
"fdbf14dc-4ba9-49ca-a342-eac3359c8982"],
Cell[46021, 1160, 147, 3, 55, "Input", "ExpressionUUID" -> \
"9cc917c8-d170-4c20-ad91-c63508415c47"],
Cell[CellGroupData[{
Cell[46193, 1167, 10499, 287, 520, "Input", "ExpressionUUID" -> \
"61d2e58f-b248-4896-83fb-6b9b362760a7"],
Cell[56695, 1456, 1042, 35, 34, "Output", "ExpressionUUID" -> \
"f48e7035-b17a-4ec6-9be2-2048cffd514d"]
}, Open  ]],
Cell[57752, 1494, 152, 3, 32, "Input", "ExpressionUUID" -> \
"3c21e4c2-ae46-41c9-9847-ce50b672bc7c"],
Cell[CellGroupData[{
Cell[57929, 1501, 3900, 94, 353, "Input", "ExpressionUUID" -> \
"16477688-e052-435a-97f9-e2ae634b6d28"],
Cell[CellGroupData[{
Cell[61854, 1599, 242, 4, 24, "Print", "ExpressionUUID" -> \
"688877f6-9885-4520-86ed-3d6caace0da0"],
Cell[62099, 1605, 240, 4, 24, "Print", "ExpressionUUID" -> \
"6843ab0e-f371-4186-836f-278c912bb55c"],
Cell[62342, 1611, 240, 4, 24, "Print", "ExpressionUUID" -> \
"0d93b97d-f94e-46b2-8b0a-905371d261b4"],
Cell[62585, 1617, 242, 4, 24, "Print", "ExpressionUUID" -> \
"4fb3e366-5e53-4e35-8d7c-5747feed5036"],
Cell[62830, 1623, 240, 4, 24, "Print", "ExpressionUUID" -> \
"53eafd38-442d-40cd-bc63-d37f5e09e7da"],
Cell[63073, 1629, 240, 4, 24, "Print", "ExpressionUUID" -> \
"b96ac247-c530-46de-bad8-11d676394cbd"]
}, Open  ]]
}, Open  ]],
Cell[63340, 1637, 5625, 137, 512, "Input", "ExpressionUUID" -> \
"8e14a896-3474-4389-98a3-4fdea547e4b4"],
Cell[68968, 1776, 4415, 114, 420, "Input", "ExpressionUUID" -> \
"e4cd5d25-8782-4ef6-84ea-0c76aecf7a63"],
Cell[73386, 1892, 425, 8, 231, "Input", "ExpressionUUID" -> \
"160a8d72-e357-456b-856f-0603505aa090"],
Cell[73814, 1902, 8325, 200, 512, "Input", "ExpressionUUID" -> \
"3e7e2a88-e90f-4b35-8ccc-0a8b67bcba39"],
Cell[CellGroupData[{
Cell[82164, 2106, 1137, 33, 86, "Input", "ExpressionUUID" -> \
"255b8617-9318-45ae-ae2d-c4057278857b"],
Cell[83304, 2141, 562, 17, 37, "Output", "ExpressionUUID" -> \
"8c9dd0db-e8d8-4dc7-a217-38f78c554edd"],
Cell[83869, 2160, 867, 16, 33, "Message", "ExpressionUUID" -> \
"f00d1ff1-93a9-40ae-86bc-35918b7b7363"],
Cell[84739, 2178, 349, 9, 41, "Message", "ExpressionUUID" -> \
"d956dc7f-92e9-421f-9276-c90bd9d9097e"],
Cell[85091, 2189, 433, 10, 23, "Message", "ExpressionUUID" -> \
"33cb5466-c3cb-4a05-93ce-0546b915a506"],
Cell[85527, 2201, 1186, 22, 120, "Message", "ExpressionUUID" -> \
"6baa00c4-bf35-4e68-b05a-1ff65e2a1d83"],
Cell[86716, 2225, 1214, 21, 120, "Message", "ExpressionUUID" -> \
"a8b5fa94-6368-4567-a0fb-bf787915bc69"],
Cell[87933, 2248, 842, 21, 149, "Output", "ExpressionUUID" -> \
"5db02a8d-247e-4dcf-aced-715b6040c893"]
}, Open  ]],
Cell[CellGroupData[{
Cell[88812, 2274, 2186, 48, 126, "Input", "ExpressionUUID" -> \
"21e8f103-87d1-4bf6-9114-992f7095dff3"],
Cell[91001, 2324, 187, 4, 32, "Output", "ExpressionUUID" -> \
"47b412f0-2f1e-4b6f-a715-5ffde8f14074"],
Cell[91191, 2330, 497, 7, 286, "Output", "ExpressionUUID" -> \
"46f1677f-1e2a-4b53-ad8a-0a1334457c89"]
}, Open  ]],
Cell[CellGroupData[{
Cell[91725, 2342, 256, 6, 32, "Input", "ExpressionUUID" -> \
"4bca066b-acf3-431e-afb2-0d90de032b54"],
Cell[91984, 2350, 1913, 26, 630, "Output", "ExpressionUUID" -> \
"10d18bf2-bbb1-4dc1-a1c8-5d290fc0eb6e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[93934, 2381, 410, 11, 56, "Input", "ExpressionUUID" -> \
"6da22d02-59b5-4126-bded-b4be1a9f5e50"],
Cell[94347, 2394, 160, 3, 32, "Output", "ExpressionUUID" -> \
"4c034293-dd26-4ea5-b107-3ab1e1840182"]
}, Open  ]],
Cell[CellGroupData[{
Cell[94544, 2402, 3565, 100, 192, "Input", "ExpressionUUID" -> \
"e9909e52-d29c-4e3e-a46d-b6e1585d461c"],
Cell[98112, 2504, 2754, 59, 430, "Output", "ExpressionUUID" -> \
"4df4503d-ec0c-483a-9e1a-0503823cd5d4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[100903, 2568, 3683, 106, 308, "Input", "ExpressionUUID" -> \
"a6c7baea-a9e5-4acc-bb64-078d37c23558"],
Cell[104589, 2676, 658, 15, 446, "Output", "ExpressionUUID" -> \
"12e6d578-d77f-498c-9367-7f951b42fe95"],
Cell[105250, 2693, 266, 6, 32, "Output", "ExpressionUUID" -> \
"82c6e2f1-6049-4eb1-b8ab-ae9706dc874b"],
Cell[105519, 2701, 266, 6, 32, "Output", "ExpressionUUID" -> \
"8469ccd3-277d-47d2-912e-0abc20507abb"]
}, Open  ]]
}
]
*)

